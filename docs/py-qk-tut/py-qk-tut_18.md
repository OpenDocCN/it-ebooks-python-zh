## Python 进阶 09 动态类型

[`www.cnblogs.com/vamei/archive/2012/07/10/2582795.html`](http://www.cnblogs.com/vamei/archive/2012/07/10/2582795.html)

作者：Vamei 出处：http://www.cnblogs.com/vamei 欢迎转载，也请保留这段声明。谢谢！

谢谢[TeaEra](http://home.cnblogs.com/u/449246/), [猫咪 cat](http://home.cnblogs.com/u/460886/)

动态类型(dynamic typing)是 Python 另一个重要的核心概念。我们之前说过，Python 的变量(variable)不需要声明，而在赋值时，变量可以重新赋值为任意值。这些都与动态类型的概念相关。

1\. 动态类型

在我们接触的对象中，有一类特殊的对象，是用于存储数据的。常见的该类对象包括各种数字，字符串，表，词典。在 C 语言中，我们称这样一些数据结构为变量。而在 Python 中，这些是对象。

对象是储存在内存中的实体。而我们的变量，实际上只是指向这一对象的参考(reference)，类似于 C 语言的指针。

（在 C 语言中，变量自身就是存储于内存中的实体）

变量和它所指的对象的分离，就是动态类型的核心。由于变量只类似于一个指针，所以它可以随时指向一个新的对象，即使这个新的对象的类型发生了变化。

第一个语句中，3 是储存在内存中的一个整数对象。通过赋值，我们将在内存中建立这一对象，并将变量 a 指向改对象。

第二个语句中，我们在内存中建立对象‘at’， 其类型是字符串(string)。变量 a 在此又指向了'at'。而此时，对象 3 不再有变量指向它，Python 会自动将没有变量指向的对象销毁(destruct)，从而释放相应内存。

(对于小的整数和短字符串，实际上 Python 会缓存这些对象，而不是针对每次赋值而分别建立和销毁。但从逻辑层面上来说，上面的说法并没有问题。我们将忽略这一细节)

再看这个例子。通过前两个句子，我们让 a,b 指向同一个整数对象 5(b = a 的含义是让变量 b 指向变量 a 所指的那一个对象)。但第三个句子实际上对变量 a 重新赋值，让 a 指向一个新的对象 7。此时 a,b 分别指向不同的对象。我们看到，即使是多个变量指向同一个对象，如果一个变量值发生变化，那么实际上是让这个变量指向一个新的变量，并不影响其他的变量的指向。从效果上看，就是各个变量各自独立，互不影响。

不止是整数如此，其它数据对象也是如此:

```py
L1 = [1,2,3]
L2 = L1
L1 = 1

```

但注意以下情况

```py
L1 = [1,2,3]
L2 = L1
L1[0] = 10
print L2

```

在该情况下，我们不再对 L1 这一变量赋值，而是对 L1 所指向的表的元素赋值。结果是，L2 也同时发生变化。

原因何在呢？因为 L1，L2 的指向没有发生变化，依然指向那个表。表实际上是包含了多个变量的对象（每个变量是一个元素，比如 L1[0]，L1[1]..., 每个变量指向一个对象，比如 1,2,3), 。而 L1[0] = 10 这一赋值操作，并不是改变 L1 的指向，而是对 L1[0], 也就是表对象的一部份(一个元素)，进行操作，所以所有指向该对象的变量都受到影响。

（与之形成对比的是，我们之前的赋值操作都没有对对象自身发生作用，只是改变变量指向。）

像表这样，可以通过引用元素，改变内存中的对象自身(in-place change)的对象类型，称为可变数据对象(mutable object)，词典也是这样的数据类型。

而像之前的数字和字符串，不能改变对象本身，只能改变变量的指向，称为不可变数据对象(immutable object)。我们之前学的定值表(tuple)，尽管可以引用引用元素，但不可以通过赋值改变元素，也因此不能对对象本身进行改变，也是 immutable object.

2\. 从动态类型看函数的参数传递

函数的参数传递，实际上是让函数的各个参数作为变量，指向对象。比如说：

```py
def f(x):
    x = 100
    print x

a = 1 f(a) print a

```

在调用函数 f()时，实际上函数让参数作为一个变量，指向 a 所指的对象。如果参数是不可变(immutable)的对象，那么如上面所讲，各个变量之间相当于相互独立。参数传递类似于 C 语言中的值传递。

如果是参数是可变(mutable)的对象，那么存在有改变对象自身的可能性，所有指向该对象的变量(无论是函数中的参数，还是主程序中的变量)都会受影响，编程的时候要对此问题留心。比如说：

```py
def f(x):
    x[0] = 100
    print x

a = [1,2,3]
f(a) print a

```

 动态类型是 Python 的核心机制之一。可以在应用中慢慢熟悉。

总结:

变量和对象的分离，对象是内存中储存数据的实体，变量指向对象。

可变对象，不可变对象

函数值传递